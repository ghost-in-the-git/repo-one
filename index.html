<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mech Battle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0f;
            color: #00ff88;
            min-height: 100vh;
            display: flex;
        }

        /* Stats Panel */
        .stats-panel {
            width: 250px;
            background: #12121a;
            border-right: 2px solid #00ff88;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .stats-panel h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff8855;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #00ff8833;
        }

        .stat-label {
            color: #888;
        }

        .stat-value {
            color: #00ff88;
            font-weight: bold;
        }

        .hp-bar-container {
            margin-top: 20px;
            background: #1a1a2e;
            border: 1px solid #00ff88;
            border-radius: 4px;
            overflow: hidden;
        }

        .hp-bar {
            height: 24px;
            background: linear-gradient(90deg, #00ff88, #00cc66);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hp-text {
            color: #0a0a0f;
            font-weight: bold;
            font-size: 12px;
        }

        .xp-bar-container {
            margin-top: 10px;
            background: #1a1a2e;
            border: 1px solid #4488ff;
            border-radius: 4px;
            overflow: hidden;
        }

        .xp-bar {
            height: 16px;
            background: linear-gradient(90deg, #4488ff, #2266cc);
            transition: width 0.3s ease;
        }

        .xp-label {
            text-align: center;
            font-size: 11px;
            color: #4488ff;
            margin-top: 4px;
        }

        /* Chat Panel */
        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #0d0d14;
        }

        .chat-header {
            padding: 15px 20px;
            background: #12121a;
            border-bottom: 2px solid #00ff88;
            text-align: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            padding: 10px 15px;
            border-radius: 8px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.system {
            background: #1a1a2e;
            border-left: 3px solid #ffaa00;
            color: #ffaa00;
            align-self: center;
            max-width: 90%;
        }

        .message.enemy {
            background: #2a1a1a;
            border-left: 3px solid #ff4444;
            color: #ff6666;
        }

        .message.player {
            background: #1a2a1a;
            border-left: 3px solid #00ff88;
            color: #00ff88;
            align-self: flex-end;
        }

        .message.battle {
            background: #1a1a2e;
            border-left: 3px solid #4488ff;
            color: #88aaff;
            font-style: italic;
        }

        .message.damage {
            background: #2a1a2a;
            border-left: 3px solid #ff44aa;
            color: #ff88cc;
        }

        .message.victory {
            background: #1a2a2a;
            border-left: 3px solid #00ffcc;
            color: #00ffcc;
            font-weight: bold;
        }

        .message.defeat {
            background: #2a1a1a;
            border-left: 3px solid #ff0000;
            color: #ff4444;
            font-weight: bold;
        }

        .message.levelup {
            background: #2a2a1a;
            border-left: 3px solid #ffdd00;
            color: #ffdd00;
            font-weight: bold;
            text-align: center;
        }

        /* Action Panel */
        .action-panel {
            padding: 20px;
            background: #12121a;
            border-top: 2px solid #00ff88;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .action-btn {
            padding: 12px 30px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            border: 2px solid;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
        }

        .action-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .action-btn.engage {
            background: #1a2a1a;
            border-color: #00ff88;
            color: #00ff88;
        }

        .action-btn.engage:hover:not(:disabled) {
            background: #00ff88;
            color: #0a0a0f;
            box-shadow: 0 0 20px #00ff8855;
        }

        .action-btn.retreat {
            background: #2a1a1a;
            border-color: #ff4444;
            color: #ff4444;
        }

        .action-btn.retreat:hover:not(:disabled) {
            background: #ff4444;
            color: #0a0a0f;
            box-shadow: 0 0 20px #ff444455;
        }

        .timer-display {
            text-align: center;
            padding: 10px;
            color: #666;
            font-size: 12px;
        }

        /* Scrollbar */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #12121a;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #00ff8855;
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #00ff88;
        }
    </style>
</head>
<body>
    <div class="stats-panel">
        <h2>[ MECH STATUS ]</h2>

        <div class="hp-bar-container">
            <div class="hp-bar" id="hp-bar">
                <span class="hp-text" id="hp-text">100 / 100</span>
            </div>
        </div>

        <div class="xp-bar-container">
            <div class="xp-bar" id="xp-bar" style="width: 0%"></div>
        </div>
        <div class="xp-label" id="xp-label">XP: 0 / 10</div>

        <div style="margin-top: 20px;">
            <div class="stat-row">
                <span class="stat-label">Level</span>
                <span class="stat-value" id="stat-level">1</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Attack</span>
                <span class="stat-value" id="stat-attack">5</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Speed</span>
                <span class="stat-value" id="stat-speed">10</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Defence</span>
                <span class="stat-value" id="stat-defence">3</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Combo</span>
                <span class="stat-value" id="stat-combo">5%</span>
            </div>
        </div>

        <div class="timer-display" id="timer-display">
            Next wave in: --:--
        </div>
    </div>

    <div class="chat-panel">
        <div class="chat-header">
            <h1>[ BATTLE LOG ]</h1>
        </div>

        <div class="chat-messages" id="chat-messages">
            <!-- Messages appear here -->
        </div>

        <div class="action-panel">
            <button class="action-btn engage" id="btn-engage" disabled>Engage</button>
            <button class="action-btn retreat" id="btn-retreat" disabled>Decline</button>
        </div>
    </div>

    <script>
        // Game State
        const game = {
            player: {
                level: 1,
                xp: 0,
                xpToLevel: 10,
                maxHp: 100,
                hp: 100,
                attack: 5,
                speed: 10,
                defence: 3,
                combo: 5
            },
            currentWave: null,
            inBattle: false,
            battleInterval: null,
            regenInterval: null,
            waveTimer: null,
            nextWaveTime: 0,
            WAVE_INTERVAL: 300000, // 5 minutes
            REGEN_RATE: 1000 // 1 hp per second
        };

        // DOM Elements
        const chatMessages = document.getElementById('chat-messages');
        const btnEngage = document.getElementById('btn-engage');
        const btnRetreat = document.getElementById('btn-retreat');
        const timerDisplay = document.getElementById('timer-display');

        // Add message to chat
        function addMessage(text, type = 'system') {
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.textContent = text;
            chatMessages.appendChild(msg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Update UI
        function updateStats() {
            const p = game.player;

            // HP Bar
            const hpPercent = (p.hp / p.maxHp) * 100;
            document.getElementById('hp-bar').style.width = `${hpPercent}%`;
            document.getElementById('hp-text').textContent = `${p.hp} / ${p.maxHp}`;

            // XP Bar
            const xpPercent = (p.xp / p.xpToLevel) * 100;
            document.getElementById('xp-bar').style.width = `${xpPercent}%`;
            document.getElementById('xp-label').textContent = `XP: ${p.xp} / ${p.xpToLevel}`;

            // Stats
            document.getElementById('stat-level').textContent = p.level;
            document.getElementById('stat-attack').textContent = p.attack;
            document.getElementById('stat-speed').textContent = p.speed;
            document.getElementById('stat-defence').textContent = p.defence;
            document.getElementById('stat-combo').textContent = `${p.combo}%`;
        }

        // Level up check
        function checkLevelUp() {
            const p = game.player;
            if (p.xp >= p.xpToLevel) {
                p.xp -= p.xpToLevel;
                p.level++;
                p.xpToLevel = Math.floor(p.xpToLevel * 1.5);

                // Stat increases
                p.maxHp += 10;
                p.hp = p.maxHp; // Full heal on level up
                p.attack += 2;
                p.speed += 3;
                p.defence += 1;
                p.combo = Math.min(p.combo + 2, 50); // Cap at 50%

                addMessage(`*** LEVEL UP! You are now Level ${p.level}! ***`, 'levelup');
                addMessage(`Stats increased! ATK+2, SPD+3, DEF+1, COMBO+2%, MAX HP+10`, 'system');
                updateStats();

                // Check for another level up
                checkLevelUp();
            }
        }

        // Generate enemy wave
        function generateWave() {
            const baseEnemies = 5 + game.player.level * 2;
            const variance = Math.floor(Math.random() * 5) - 2;
            const enemyCount = Math.max(3, baseEnemies + variance);

            return {
                count: enemyCount,
                hp: enemyCount,
                damage: 1 // Each droid does 1 damage
            };
        }

        // Spawn new wave
        function spawnWave() {
            if (game.inBattle || game.currentWave) return;

            game.currentWave = generateWave();
            addMessage(`${game.currentWave.count} droids have appeared! Do you want to engage them?`, 'enemy');

            btnEngage.disabled = false;
            btnRetreat.disabled = false;
        }

        // Start wave timer
        function startWaveTimer() {
            game.nextWaveTime = Date.now() + game.WAVE_INTERVAL;

            if (game.waveTimer) clearInterval(game.waveTimer);

            game.waveTimer = setInterval(() => {
                const remaining = Math.max(0, game.nextWaveTime - Date.now());
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                timerDisplay.textContent = `Next wave in: ${minutes}:${seconds.toString().padStart(2, '0')}`;

                if (remaining <= 0) {
                    spawnWave();
                    startWaveTimer();
                }
            }, 1000);
        }

        // Battle round
        async function battleRound() {
            const p = game.player;
            const wave = game.currentWave;

            if (!wave || wave.hp <= 0 || p.hp <= 0) {
                endBattle();
                return;
            }

            // Player attacks
            let damage = p.attack;
            let comboTriggered = Math.random() * 100 < p.combo;

            if (comboTriggered) {
                damage *= 2;
                addMessage(`COMBO! Your attack power doubles!`, 'victory');
            }

            const actualDamage = Math.min(damage, wave.hp);
            wave.hp -= actualDamage;

            addMessage(`You attack for ${actualDamage} damage!`, 'player');
            addMessage(`${actualDamage} droids destroyed!`, 'battle');

            // Check if wave defeated
            if (wave.hp <= 0) {
                await delay(500);
                endBattle(true);
                return;
            }

            // Speed check for extra attack
            if (Math.random() * 100 < p.speed) {
                addMessage(`Your mech moves fast! Extra attack!`, 'system');
                await delay(500);

                let bonusDamage = p.attack;
                let bonusCombo = Math.random() * 100 < p.combo;

                if (bonusCombo) {
                    bonusDamage *= 2;
                    addMessage(`COMBO on bonus attack!`, 'victory');
                }

                const bonusActual = Math.min(bonusDamage, wave.hp);
                wave.hp -= bonusActual;

                addMessage(`Bonus attack deals ${bonusActual} damage!`, 'player');
                addMessage(`${bonusActual} more droids destroyed!`, 'battle');

                if (wave.hp <= 0) {
                    await delay(500);
                    endBattle(true);
                    return;
                }
            }

            await delay(500);

            // Enemies attack
            const enemyDamage = wave.hp * wave.damage;
            const blocked = Math.min(p.defence, enemyDamage);
            const takenDamage = enemyDamage - blocked;

            addMessage(`${wave.hp} droids attack!`, 'enemy');

            if (blocked > 0) {
                addMessage(`Your DEF blocks ${blocked} damage!`, 'battle');
            }

            if (takenDamage > 0) {
                p.hp = Math.max(0, p.hp - takenDamage);
                addMessage(`You take ${takenDamage} damage!`, 'damage');
                updateStats();
            } else {
                addMessage(`All damage blocked!`, 'victory');
            }

            // Check if player defeated
            if (p.hp <= 0) {
                await delay(500);
                endBattle(false);
                return;
            }

            await delay(800);
        }

        // End battle
        function endBattle(victory = false) {
            game.inBattle = false;

            if (game.battleInterval) {
                clearInterval(game.battleInterval);
                game.battleInterval = null;
            }

            const droidsKilled = game.currentWave ? game.currentWave.count - game.currentWave.hp : 0;

            if (victory) {
                addMessage(`*** VICTORY! All droids destroyed! ***`, 'victory');
                game.player.xp += droidsKilled;
                addMessage(`You gained ${droidsKilled} XP!`, 'system');
                checkLevelUp();
            } else {
                addMessage(`*** DEFEAT! Your mech has been destroyed! ***`, 'defeat');
                addMessage(`You gained no XP this battle.`, 'system');
                // Respawn with half HP
                game.player.hp = Math.floor(game.player.maxHp / 2);
            }

            game.currentWave = null;
            updateStats();
            startRegen();
            startWaveTimer();
        }

        // Start HP regeneration
        function startRegen() {
            if (game.regenInterval) clearInterval(game.regenInterval);

            game.regenInterval = setInterval(() => {
                if (game.inBattle) return;

                if (game.player.hp < game.player.maxHp) {
                    game.player.hp = Math.min(game.player.maxHp, game.player.hp + 1);
                    updateStats();
                } else {
                    clearInterval(game.regenInterval);
                    game.regenInterval = null;
                }
            }, game.REGEN_RATE);
        }

        // Utility delay
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Engage battle
        async function engageBattle() {
            if (!game.currentWave || game.inBattle) return;

            btnEngage.disabled = true;
            btnRetreat.disabled = true;
            game.inBattle = true;

            if (game.regenInterval) {
                clearInterval(game.regenInterval);
                game.regenInterval = null;
            }

            addMessage(`Engaging ${game.currentWave.count} droids!`, 'player');
            await delay(500);
            addMessage(`Your mech moves to engage the enemy...`, 'battle');
            await delay(1000);

            // Battle loop
            async function runBattle() {
                while (game.inBattle && game.currentWave && game.currentWave.hp > 0 && game.player.hp > 0) {
                    await battleRound();
                }
            }

            runBattle();
        }

        // Decline battle
        function declineBattle() {
            if (!game.currentWave || game.inBattle) return;

            addMessage(`You choose not to engage. The droids move on...`, 'player');
            game.currentWave = null;
            btnEngage.disabled = true;
            btnRetreat.disabled = true;
        }

        // Event listeners
        btnEngage.addEventListener('click', engageBattle);
        btnRetreat.addEventListener('click', declineBattle);

        // Initialize game
        function init() {
            addMessage(`=== MECH BATTLE SYSTEM ONLINE ===`, 'system');
            addMessage(`Your mech is ready for combat, pilot.`, 'system');
            addMessage(`Enemies will appear periodically. Choose to engage or decline.`, 'system');
            updateStats();

            // Spawn first wave immediately for testing
            setTimeout(() => {
                spawnWave();
                startWaveTimer();
            }, 2000);
        }

        init();
    </script>
</body>
</html>
